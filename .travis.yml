dist: xenial
sudo: required
language: perl
perl:
   - "blead"
   - "5.26"
   - "5.24"
   - "5.22"
   - "5.20"
   - "5.18"
   - "5.16"
   - "5.14"
   - "5.12"
   - "5.10"
   - "5.8"

matrix:
   include:
      - perl: 5.18
        env: COVERAGE=1      
   allow_failures:
      - perl: "blead"

before_install:
   - sudo apt-get update
   - mkdir v1
   - cd v1
   - wget https://github.com/webmproject/libwebp/archive/v1.0.0.tar.gz
   - tar zxf v1.0.0.tar.gz
   - cd v1.0.0
   - ./autogen.sh
   - ./configure
   - make
   - make install
   - git clone git://github.com/travis-perl/helpers ~/travis-perl-helpers
   - source ~/travis-perl-helpers/init
   - build-perl
   - perl -V
   - gcc --version
   - build-dist
   - cd $BUILD_DIR             

install:
   - cpan-install --deps
   - cpan-install --coverage

before_script:
   - coverage-setup

script:
   - perl Makefile.PL
   - make
   - prove -lrsv -j$((SYSTEM_CORES + 1)) $(test-dirs) t

after_success:
   - coverage-report
